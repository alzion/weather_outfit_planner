<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather & Outfit Planner (DeepSeek)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            position: relative;
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #6366f1; /* DeepSeek Purple/Blue */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .modal-backdrop { background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(4px); }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="glass-panel w-full max-w-md rounded-2xl shadow-xl overflow-hidden p-8">
        
        <div class="absolute top-4 left-4">
            <button onclick="toggleHelp()" class="text-slate-400 hover:text-indigo-600 transition-colors">
                <i class="fa-solid fa-circle-question text-xl"></i>
            </button>
        </div>

        <div class="absolute top-4 right-4">
            <select id="languageSelect" onchange="changeLanguage()" class="bg-white/50 border border-slate-200 text-slate-600 text-xs rounded-lg px-2 py-1 focus:outline-none focus:ring-1 focus:ring-indigo-400 cursor-pointer">
                <option value="en">üá∫üá∏ English</option>
                <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                <option value="kk">üá∞üáø “ö–∞–∑–∞“õ—à–∞</option>
            </select>
        </div>

        <div class="text-center mb-8 mt-4">
            <div class="bg-indigo-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-indigo-600">
                <i class="fa-solid fa-shirt text-2xl"></i>
            </div>
            <h1 id="ui-title" class="text-2xl font-bold text-slate-800">Outfit Planner</h1>
            <p id="ui-subtitle" class="text-slate-500 text-sm mt-1">Powered by DeepSeek</p>
        </div>

        <div class="space-y-4">
            
            <div class="bg-indigo-50/50 p-3 rounded-lg flex flex-wrap items-center justify-center gap-4">
                <label class="flex items-center gap-2 cursor-pointer group">
                    <input type="radio" name="timeFrame" value="current" checked class="accent-indigo-600 w-4 h-4 cursor-pointer">
                    <span id="ui-time-now" class="text-sm text-slate-600 font-medium group-hover:text-indigo-600 transition-colors">Right Now</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer group">
                    <input type="radio" name="timeFrame" value="workday" class="accent-indigo-600 w-4 h-4 cursor-pointer">
                    <span id="ui-time-work" class="text-sm text-slate-600 font-medium group-hover:text-indigo-600 transition-colors">Workday (9-5)</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer group">
                    <input type="radio" name="timeFrame" value="nightout" class="accent-indigo-600 w-4 h-4 cursor-pointer">
                    <span id="ui-time-night" class="text-sm text-slate-600 font-medium group-hover:text-indigo-600 transition-colors">Night Out</span>
                </label>
            </div>

            <div>
                <label id="ui-label" for="cityInput" class="block text-xs font-semibold text-slate-500 uppercase tracking-wide mb-2">Your Location</label>
                <div class="relative">
                    <input type="text" id="cityInput" placeholder="e.g. New York, London, Tokyo" 
                        class="w-full bg-slate-50 border border-slate-200 rounded-lg py-3 px-4 pl-10 pr-12 text-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all">
                    <i class="fa-solid fa-location-dot absolute left-4 top-3.5 text-slate-400"></i>
                    
                    <button onclick="useDeviceLocation()" class="absolute right-3 top-2.5 p-1 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-all">
                        <i class="fa-solid fa-location-crosshairs text-lg"></i>
                    </button>
                </div>
            </div>

            <button id="getWeatherBtn" onclick="getRecommendation()" 
                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2">
                <span id="ui-btn">Get Advice</span>
                <i class="fa-solid fa-arrow-right"></i>
            </button>
        </div>

        <div id="loader" class="hidden mt-6 text-center">
            <div class="loader mx-auto mb-2"></div>
            <p id="ui-loading" class="text-sm text-slate-400 animate-pulse">Checking the forecast...</p>
            <p id="ui-wait-msg" class="text-xs text-slate-300 mt-1">(Fetching weather data & asking DeepSeek)</p>
        </div>

        <div id="errorMessage" class="hidden mt-6 bg-red-50 text-red-600 p-4 rounded-lg text-sm border border-red-100 flex items-start gap-3">
            <i class="fa-solid fa-circle-exclamation mt-0.5"></i>
            <span id="errorText">Something went wrong.</span>
        </div>

        <div id="resultSection" class="hidden mt-8 border-t border-slate-100 pt-6 animate-fade-in">
            <div class="flex items-center gap-4 mb-6">
                <div class="bg-orange-100 text-orange-500 w-12 h-12 rounded-xl flex items-center justify-center shrink-0">
                    <i class="fa-solid fa-cloud-sun text-xl"></i>
                </div>
                <div>
                    <h3 id="ui-weather-title" class="font-bold text-slate-700">Current Weather</h3>
                    <p id="weatherText" class="text-sm text-slate-500 leading-snug">--</p>
                </div>
            </div>

            <div class="bg-indigo-50 rounded-xl p-5 border border-indigo-100">
                <div class="flex items-center gap-2 mb-3 text-indigo-800 font-semibold">
                    <i class="fa-solid fa-hat-wizard"></i>
                    <h3 id="ui-outfit-title">Outfit Recommendations</h3>
                </div>
                <div id="outfitContainer" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <div id="helpModal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl p-6 relative animate-fade-in">
            <button onclick="toggleHelp()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i class="fa-solid fa-xmark text-xl"></i></button>
            <h2 id="ui-help-title" class="text-xl font-bold text-slate-800 mb-4">How it works</h2>
            <p class="text-sm text-slate-600 mb-4">This app uses Open-Meteo for weather data and DeepSeek AI for reasoning.</p>
            <button onclick="toggleHelp()" id="ui-help-close" class="mt-6 w-full bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold py-2 rounded-lg transition-colors">Got it</button>
        </div>
    </div>

    <script>
        // =========================================================
        // CONFIGURATION: PASTE DEEPSEEK KEY HERE
        // =========================================================
        const apiKey ='sk-d81b5e030c4c4c96addd057a105a9d72'; 
        // =========================================================

        const translations = {
            en: { title: "Outfit Planner", btn: "Get Advice", loading: "Thinking...", weatherTitle: "Weather Conditions", outfitTitle: "Recommendations", promptLang: "English", emptyCity: "Please enter a city name.", correctedPrefix: "Weather for: ", locating: "Locating...", geoError: "Location not found.", timeNow: "Right Now", timeWork: "Workday (9-5)", timeNight: "Night Out" },
            ru: { title: "–ì–∞—Ä–¥–µ—Ä–æ–±", btn: "–ü–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç", loading: "–î—É–º–∞–µ–º...", weatherTitle: "–ü–æ–≥–æ–¥–∞", outfitTitle: "–°–æ–≤–µ—Ç—ã", promptLang: "Russian", emptyCity: "–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥.", correctedPrefix: "–ü–æ–≥–æ–¥–∞: ", locating: "–ò—â–µ–º...", geoError: "–ù–µ –Ω–∞–π–¥–µ–Ω–æ.", timeNow: "–°–µ–π—á–∞—Å", timeWork: "–†–∞–±–æ—á–∏–π –¥–µ–Ω—å", timeNight: "–í–µ—á–µ—Ä" },
            kk: { title: "–ö–∏—ñ–º —Ç–∞“£–¥–∞—É", btn: "–ö–µ“£–µ—Å –∞–ª—É", loading: "–û–π–ª–∞–Ω—É–¥–∞...", weatherTitle: "–ê—É–∞ —Ä–∞–π—ã", outfitTitle: "“∞—Å—ã–Ω—ã—Å—Ç–∞—Ä", promptLang: "Kazakh", emptyCity: "“ö–∞–ª–∞ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑.", correctedPrefix: "–ê—É–∞ —Ä–∞–π—ã: ", locating: "–Ü–∑–¥–µ—É–¥–µ...", geoError: "–¢–∞–±—ã–ª–º–∞–¥—ã.", timeNow: "“ö–∞–∑—ñ—Ä", timeWork: "–ñ“±–º—ã—Å –∫“Ø–Ω—ñ", timeNight: "–ö–µ—à–∫—ñ —Å–µ—Ä—É–µ–Ω" }
        };

        let currentLang = 'en';

        // 1. Get Coordinates from City Name
        async function getCoordinates(city) {
            const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=en&format=json`;
            const res = await fetch(url);
            const data = await res.json();
            if (!data.results || data.results.length === 0) throw new Error("City not found");
            return data.results[0]; // { latitude, longitude, name, country }
        }

        // 2. Get Weather Data from Coordinates
        async function getWeather(lat, lon) {
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,precipitation,rain,showers,snowfall,weather_code,wind_speed_10m&daily=temperature_2m_max,temperature_2m_min,weather_code&timezone=auto&forecast_days=2`;
            const res = await fetch(url);
            return await res.json();
        }

        // 3. Interpret Weather Code (WMO)
        function getWeatherDescription(code) {
            const codes = { 0: "Clear sky", 1: "Mainly clear", 2: "Partly cloudy", 3: "Overcast", 45: "Fog", 61: "Rain", 71: "Snow", 95: "Thunderstorm" };
            return codes[code] || "Variable conditions";
        }

        async function getRecommendation() {
            let cityInput = document.getElementById('cityInput').value.trim();
            const t = translations[currentLang];
            const timeFrameValue = document.querySelector('input[name="timeFrame"]:checked').value;

            if (!cityInput) return alert(t.emptyCity);
            if (apiKey === "PASTE_YOUR_KEY_HERE" || !apiKey) return alert("Please paste your DeepSeek API Key in the code (Line 173).");

            // UI Reset
            document.getElementById('errorMessage').classList.add('hidden');
            document.getElementById('resultSection').classList.add('hidden');
            document.getElementById('loader').classList.remove('hidden');

            try {
                // STEP 1: Geocoding
                let lat, lon, resolvedName;
                
                // Check if input is "lat, lon" (from device location)
                if (cityInput.includes(',')) {
                    [lat, lon] = cityInput.split(',').map(s => parseFloat(s.trim()));
                    resolvedName = "Your Location";
                } else {
                    const geoData = await getCoordinates(cityInput);
                    lat = geoData.latitude;
                    lon = geoData.longitude;
                    resolvedName = `${geoData.name}, ${geoData.country}`;
                }

                // STEP 2: Fetch Weather (Open-Meteo)
                const weatherData = await getWeather(lat, lon);
                
                // Parse Weather Data based on TimeFrame
                const current = weatherData.current;
                const daily = weatherData.daily;
                let weatherSummary = "";
                let dateTarget = "";

                if (timeFrameValue === 'workday') {
                    // Simple logic: if after 11am, assume tomorrow
                    const hour = new Date().getHours();
                    const isTomorrow = hour >= 11;
                    const idx = isTomorrow ? 1 : 0;
                    dateTarget = isTomorrow ? "Tomorrow" : "Today";
                    weatherSummary = `${dateTarget}: Max ${daily.temperature_2m_max[idx]}¬∞C, Min ${daily.temperature_2m_min[idx]}¬∞C. ${getWeatherDescription(daily.weather_code[idx])}.`;
                } else {
                    weatherSummary = `Now: ${current.temperature_2m}¬∞C (Feels like ${current.apparent_temperature}¬∞C). ${getWeatherDescription(current.weather_code)}. Wind: ${current.wind_speed_10m} km/h.`;
                }

                // STEP 3: DeepSeek Call
                const prompt = `
                    Context: User is in ${resolvedName}. Weather data: "${weatherSummary}".
                    Task: Suggest 3 outfits for "${timeFrameValue}" (Style: Casual, Work/Smart, Active/Cozy).
                    Language: ${t.promptLang}.
                    
                    Return ONLY raw JSON (no markdown):
                    {
                        "weather_display": "${weatherSummary}",
                        "outfits": [
                            { "style": "Casual", "suggestion": "..." },
                            { "style": "Work / Smart", "suggestion": "..." },
                            { "style": "Active / Cozy", "suggestion": "..." }
                        ],
                        "icon_hint": "sun|rain|cloud|snow"
                    }
                `;

                const response = await fetch("https://api.deepseek.com/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            { role: "system", content: "You are a helpful stylist assistant. Return JSON only." },
                            { role: "user", content: prompt }
                        ],
                        response_format: { type: "json_object" }
                    })
                });

                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(`DeepSeek API Error: ${err.error?.message || response.statusText}`);
                }

                const aiData = await response.json();
                const content = JSON.parse(aiData.choices[0].message.content);

                // Render Results
                document.getElementById('weatherText').textContent = content.weather_display || weatherSummary;
                
                const container = document.getElementById('outfitContainer');
                container.innerHTML = '';
                content.outfits.forEach(item => {
                    container.innerHTML += `
                        <div class="bg-white p-3 rounded-lg border border-indigo-100 shadow-sm">
                            <div class="text-xs font-bold text-indigo-500 uppercase tracking-wide mb-1">${item.style}</div>
                            <div class="text-slate-700 text-sm leading-relaxed">${item.suggestion}</div>
                        </div>`;
                });

                // Icon
                const iconMap = { 'sun': 'fa-sun', 'rain': 'fa-cloud-showers-heavy', 'cloud': 'fa-cloud', 'snow': 'fa-snowflake' };
                const iconClass = iconMap[content.icon_hint] || 'fa-cloud-sun';
                document.querySelector('.bg-orange-100 i').className = `fa-solid ${iconClass} text-xl`;

                document.getElementById('resultSection').classList.remove('hidden');

            } catch (error) {
                console.error(error);
                document.getElementById('errorText').textContent = error.message;
                document.getElementById('errorMessage').classList.remove('hidden');
            } finally {
                document.getElementById('loader').classList.add('hidden');
            }
        }

        // Helper: Location
        function useDeviceLocation() {
            if (!navigator.geolocation) return alert("Geolocation not supported");
            document.getElementById('cityInput').placeholder = "Locating...";
            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    document.getElementById('cityInput').value = `${pos.coords.latitude}, ${pos.coords.longitude}`;
                    getRecommendation();
                },
                () => alert("Location permission denied.")
            );
        }

        // Helper: Language
        function detectSystemLanguage() {
            const lang = navigator.language || navigator.userLanguage; 
            if (lang.startsWith('ru')) currentLang = 'ru';
            else if (lang.startsWith('kk')) currentLang = 'kk';
            else currentLang = 'en';
            document.getElementById('languageSelect').value = currentLang;
            changeLanguage();
        }

        function changeLanguage() {
            currentLang = document.getElementById('languageSelect').value;
            const t = translations[currentLang];
            document.getElementById('ui-title').textContent = t.title;
            document.getElementById('ui-btn').textContent = t.btn;
            document.getElementById('ui-loading').textContent = t.loading;
            document.getElementById('ui-weather-title').textContent = t.weatherTitle;
            document.getElementById('ui-outfit-title').textContent = t.outfitTitle;
            document.getElementById('ui-time-now').textContent = t.timeNow;
            document.getElementById('ui-time-work').textContent = t.timeWork;
            document.getElementById('ui-time-night').textContent = t.timeNight;
        }

        function toggleHelp() { document.getElementById('helpModal').classList.toggle('hidden'); }
        
        detectSystemLanguage();
    </script>
</body>
</html>
